<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Js :: for wait...of | Paran.Blue</title><meta name=keywords content="js,async,wait,promise"><meta name=description content="for await&mldr;of for await...of 구문은 보통 비동기에 대응하는 열거자를 나열할 때 쓰이지만, String, Array, Array 같은 객체 (e.g., arguments or NodeList), TypedArray, Map, Set 같은 동기적으로 열거 가능한 객체 또한 가능하며, 사용자가 직접 정의한 동기 또는 비동기 객체도 나열할 수 있도록 해준다. 일반적인 for ...of 문과 마찬가지로 열거자 심볼이 정의한 속성을 실행하게 되어 열거한 값을 변수로 받아 처리한다.
구문 for await (variable of iterable) { statement }   variable"><meta name=author content="bynaki"><link rel=canonical href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/for-await...of><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.f35765cb8d4ded22290255d068770252367222a0c927f248f2ffdd0561769869.css integrity="sha256-81dly41N7SIpAlXQaHcCUjZyIqDJJ/JI8v/dBWF2mGk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://bynaki.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://bynaki.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://bynaki.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://bynaki.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://bynaki.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.85.0"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="Js :: for wait...of"><meta property="og:description" content="for await&mldr;of for await...of 구문은 보통 비동기에 대응하는 열거자를 나열할 때 쓰이지만, String, Array, Array 같은 객체 (e.g., arguments or NodeList), TypedArray, Map, Set 같은 동기적으로 열거 가능한 객체 또한 가능하며, 사용자가 직접 정의한 동기 또는 비동기 객체도 나열할 수 있도록 해준다. 일반적인 for ...of 문과 마찬가지로 열거자 심볼이 정의한 속성을 실행하게 되어 열거한 값을 변수로 받아 처리한다.
구문 for await (variable of iterable) { statement }   variable"><meta property="og:type" content="article"><meta property="og:url" content="https://bynaki.github.io/posts/js.for-wait-of/"><meta property="og:image" content="https://bynaki.github.io/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-09T18:36:53+09:00"><meta property="article:modified_time" content="2021-08-09T18:36:53+09:00"><meta property="og:site_name" content="Paran.Blue"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bynaki.github.io/%3Cimage%20path/url%3E"><meta name=twitter:title content="Js :: for wait...of"><meta name=twitter:description content="for await&mldr;of for await...of 구문은 보통 비동기에 대응하는 열거자를 나열할 때 쓰이지만, String, Array, Array 같은 객체 (e.g., arguments or NodeList), TypedArray, Map, Set 같은 동기적으로 열거 가능한 객체 또한 가능하며, 사용자가 직접 정의한 동기 또는 비동기 객체도 나열할 수 있도록 해준다. 일반적인 for ...of 문과 마찬가지로 열거자 심볼이 정의한 속성을 실행하게 되어 열거한 값을 변수로 받아 처리한다.
구문 for await (variable of iterable) { statement }   variable"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://bynaki.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Js :: for wait...of","item":"https://bynaki.github.io/posts/js.for-wait-of/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Js :: for wait...of","name":"Js :: for wait...of","description":"for await\u0026hellip;of for await...of 구문은 보통 비동기에 대응하는 열거자를 나열할 때 쓰이지만, String, Array, Array 같은 객체 (e.g., arguments or NodeList), TypedArray, Map, Set 같은 동기적으로 열거 가능한 객체 또한 가능하며, 사용자가 직접 정의한 동기 또는 비동기 객체도 나열할 수 있도록 해준다. 일반적인 for ...of 문과 마찬가지로 열거자 심볼이 정의한 속성을 실행하게 되어 열거한 값을 변수로 받아 처리한다.\n구문 for await (variable of iterable) { statement }   variable","keywords":["js","async","wait","promise"],"articleBody":"for await…of for await...of 구문은 보통 비동기에 대응하는 열거자를 나열할 때 쓰이지만, String, Array, Array 같은 객체 (e.g., arguments or NodeList), TypedArray, Map, Set 같은 동기적으로 열거 가능한 객체 또한 가능하며, 사용자가 직접 정의한 동기 또는 비동기 객체도 나열할 수 있도록 해준다. 일반적인 for ...of 문과 마찬가지로 열거자 심볼이 정의한 속성을 실행하게 되어 열거한 값을 변수로 받아 처리한다.\n구문 for await (variable of iterable) { statement }   variable\n열거할 때마다 variable. 문을 통해 변수로 받을 수 있다. variable 문 안에서는 const, let 및 var. 문으로 선언된 변수 및 상수를 선언할 수 있다.\n  iterable\n열거 가능한 속성이 들어가 있는 객체 및 식을 포함한다.\n  비동기 열거 속성을 통한 열거 식 비동기 열거 프로토콜을 담은 객체를 아래와 같이 열거할 수 있다.\nconst asyncIterable = { [Symbol.asyncIterator]() { return { i: 0, next() { if (this.i  3) { return Promise.resolve({ value: this.i++, done: false }); } return Promise.resolve({ done: true }); } }; } }; (async function() { for await (let num of asyncIterable) { console.log(num); } })(); // 0 // 1 // 2 비동기 생성자를 통한 열거 식 비동기 생성자는 애초부터 비동기 열거 프로토콜을 탑재한 채로 정의한다.이를 for await...of 식으로 아래와 같이 사용할 수 있다.\nasync function* asyncGenerator() { let i = 0; while (i  3) { yield i++; } } (async function() { for await (let num of asyncGenerator()) { console.log(num); } })(); // 0 // 1 // 2 좀 더 상세한 비동기 생성자를 통한 for await...of 식의 사용법을 위해 기본 API를 통해 값을 비동기적으로 열거하는 방법을 알아본다.\n아래 예제를 통해 먼저 API를 사용하여 스트림 데이터를 통해 비동기 열거자를 만든 뒤, 스트림에서 응답이 끝나면 최종 응답 데이터 크기를 가져온다.\nasync function* streamAsyncIterator(stream) { const reader = stream.getReader(); try { while (true) { const { done, value } = await reader.read(); if (done) { return; } yield value; } } finally { reader.releaseLock(); } } // 주소로부터 데이터를 받아온 뒤, 응답 크기를 구하는 비동기 생성자 함수. async function getResponseSize(url) { const response = await fetch(url); // 여기에 응답 크기를 바이트 단위로 적재한다.  let responseSize = 0; // for-await-of 문을 통해 응답이 들어올 때마다 열거 프로토콜을 통해 반복문이 작동한다.  for await (const chunk of streamAsyncIterator(response.body)) { // 총 응답 크기를 지속적으로 누적한다.  responseSize += chunk.length; } console.log(`응답 크기: ${responseSize}바이트`); // 예상 출력: \"응답 크기: 1071472 바이트\"  return responseSize; } getResponseSize('https://jsonplaceholder.typicode.com/photos'); My Example export class TradeDb { constructor(private readonly filename: string) { } // *  // *  // *  async * each(code: string): AsyncGeneratorIu.TradeTickType, void, unknown { const length = 500 let offset = 0 let trs = [] do { trs = await this.get(code, offset, length) for(let tr of trs) { yield tr } offset += trs.length } while(trs.length !== 0) } } export class UPbitTradeMock extends BaseUPbitSocket { constructor(private readonly db: TradeDb) { super(db.staticCodes()) } async open(): Promisevoid { await this.start() const codes = await this.db.codes() for(let code of codes) { const bots = this.getBots(I.ReqType.Trade, code) for await (let tr of this.db.each(code)) { const converted = this.convertTradeType(tr) await Promise.all(bots.map(bot = bot.trigger(converted))) } await Promise.all(bots.map(bot = bot.finish())) } } } See Also  https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/for-await...of  ","wordCount":"501","inLanguage":"en","image":"https://bynaki.github.io/%3Cimage%20path/url%3E","datePublished":"2021-08-09T18:36:53+09:00","dateModified":"2021-08-09T18:36:53+09:00","author":{"@type":"Person","name":"bynaki"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bynaki.github.io/posts/js.for-wait-of/"},"publisher":{"@type":"Organization","name":"Paran.Blue","logo":{"@type":"ImageObject","url":"https://bynaki.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://bynaki.github.io accesskey=h title="Paran.Blue (Alt + H)">Paran.Blue</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://bynaki.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://bynaki.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://bynaki.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://github.com/bynaki title=github><span>github</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://bynaki.github.io>Home</a>&nbsp;»&nbsp;<a href=https://bynaki.github.io/posts/>Posts</a></div><h1 class=post-title>Js :: for wait...of</h1><div class=post-meta>August 9, 2021&nbsp;·&nbsp;3 min&nbsp;·&nbsp;bynaki&nbsp;|&nbsp;<a href=https://github.com/bynaki/paran.blue/blob/main/content/posts/js.for-wait-of.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#for-awaitof aria-label="for await&amp;hellip;of">for await&mldr;of</a></li><li><a href=#%ea%b5%ac%eb%ac%b8httpsdevelopermozillaorgkodocswebjavascriptreferencestatementsfor-awaitof%ea%b5%ac%eb%ac%b8 aria-label=구문><a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/for-await...of#%EA%B5%AC%EB%AC%B8>구문</a></a><ul><li><a href=#%eb%b9%84%eb%8f%99%ea%b8%b0-%ec%97%b4%ea%b1%b0-%ec%86%8d%ec%84%b1%ec%9d%84-%ed%86%b5%ed%95%9c-%ec%97%b4%ea%b1%b0-%ec%8b%9dhttpsdevelopermozillaorgkodocswebjavascriptreferencestatementsfor-awaitof%eb%b9%84%eb%8f%99%ea%b8%b0_%ec%97%b4%ea%b1%b0_%ec%86%8d%ec%84%b1%ec%9d%84_%ed%86%b5%ed%95%9c_%ec%97%b4%ea%b1%b0_%ec%8b%9d aria-label="비동기 열거 속성을 통한 열거 식"><a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/for-await...of#%EB%B9%84%EB%8F%99%EA%B8%B0_%EC%97%B4%EA%B1%B0_%EC%86%8D%EC%84%B1%EC%9D%84_%ED%86%B5%ED%95%9C_%EC%97%B4%EA%B1%B0_%EC%8B%9D>비동기 열거 속성을 통한 열거 식</a></a></li><li><a href=#%eb%b9%84%eb%8f%99%ea%b8%b0-%ec%83%9d%ec%84%b1%ec%9e%90%eb%a5%bc-%ed%86%b5%ed%95%9c-%ec%97%b4%ea%b1%b0-%ec%8b%9dhttpsdevelopermozillaorgkodocswebjavascriptreferencestatementsfor-awaitof%eb%b9%84%eb%8f%99%ea%b8%b0_%ec%83%9d%ec%84%b1%ec%9e%90%eb%a5%bc_%ed%86%b5%ed%95%9c_%ec%97%b4%ea%b1%b0_%ec%8b%9d aria-label="비동기 생성자를 통한 열거 식"><a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/for-await...of#%EB%B9%84%EB%8F%99%EA%B8%B0_%EC%83%9D%EC%84%B1%EC%9E%90%EB%A5%BC_%ED%86%B5%ED%95%9C_%EC%97%B4%EA%B1%B0_%EC%8B%9D>비동기 생성자를 통한 열거 식</a></a></li></ul></li><li><a href=#my-example aria-label="My Example">My Example</a></li><li><a href=#see-also aria-label="See Also">See Also</a></li></ul></div></details></div><div class=post-content><h2 id=for-awaitof>for await&mldr;of<a hidden class=anchor aria-hidden=true href=#for-awaitof>#</a></h2><p><strong><code>for await...of</code> 구문</strong>은 보통 비동기에 대응하는 열거자를 나열할 때 쓰이지만, <a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/String><code>String</code></a>, <a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Array><code>Array</code></a>, <code>Array</code> 같은 객체 (e.g., <a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Functions/arguments><code>arguments</code></a> or <a href=https://developer.mozilla.org/en-US/docs/Web/API/NodeList><code>NodeList</code></a>), <a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/TypedArray><code>TypedArray</code></a>, <code>Map</code>, <a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Set><code>Set</code></a> 같은 동기적으로 열거 가능한 객체 또한 가능하며, 사용자가 직접 정의한 동기 또는 비동기 객체도 나열할 수 있도록 해준다. 일반적인 <strong><code>for ...of</code></strong> 문과 마찬가지로 열거자 심볼이 정의한 속성을 실행하게 되어 열거한 값을 변수로 받아 처리한다.</p><h2 id=구문httpsdevelopermozillaorgkodocswebjavascriptreferencestatementsfor-awaitof구문><a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/for-await...of#%EA%B5%AC%EB%AC%B8>구문</a><a hidden class=anchor aria-hidden=true href=#구문httpsdevelopermozillaorgkodocswebjavascriptreferencestatementsfor-awaitof구문>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>for</span> <span style=color:#66d9ef>await</span> (<span style=color:#a6e22e>variable</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>iterable</span>) {
  <span style=color:#a6e22e>statement</span>
}
</code></pre></div><ul><li><p><code>variable</code></p><p>열거할 때마다 <code>variable</code>. 문을 통해 변수로 받을 수 있다. <code>variable</code> 문 안에서는 <code>const</code>, <code>let</code> 및 <code>var</code>. 문으로 선언된 변수 및 상수를 선언할 수 있다.</p></li><li><p><code>iterable</code></p><p>열거 가능한 속성이 들어가 있는 객체 및 식을 포함한다.</p></li></ul><h3 id=비동기-열거-속성을-통한-열거-식httpsdevelopermozillaorgkodocswebjavascriptreferencestatementsfor-awaitof비동기_열거_속성을_통한_열거_식><a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/for-await...of#%EB%B9%84%EB%8F%99%EA%B8%B0_%EC%97%B4%EA%B1%B0_%EC%86%8D%EC%84%B1%EC%9D%84_%ED%86%B5%ED%95%9C_%EC%97%B4%EA%B1%B0_%EC%8B%9D>비동기 열거 속성을 통한 열거 식</a><a hidden class=anchor aria-hidden=true href=#비동기-열거-속성을-통한-열거-식httpsdevelopermozillaorgkodocswebjavascriptreferencestatementsfor-awaitof비동기_열거_속성을_통한_열거_식>#</a></h3><p>비동기 열거 프로토콜을 담은 객체를 아래와 같이 열거할 수 있다.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>asyncIterable</span> <span style=color:#f92672>=</span> {
  [<span style=color:#a6e22e>Symbol</span>.<span style=color:#a6e22e>asyncIterator</span>]() {
    <span style=color:#66d9ef>return</span> {
      <span style=color:#a6e22e>i</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,
      <span style=color:#a6e22e>next</span>() {
        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>3</span>) {
          <span style=color:#66d9ef>return</span> Promise.<span style=color:#a6e22e>resolve</span>({ <span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>, <span style=color:#a6e22e>done</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> });
        }

        <span style=color:#66d9ef>return</span> Promise.<span style=color:#a6e22e>resolve</span>({ <span style=color:#a6e22e>done</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> });
      }
    };
  }
};

(<span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span>() {
   <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>await</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>num</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>asyncIterable</span>) {
     <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>num</span>);
   }
})();

<span style=color:#75715e>// 0
</span><span style=color:#75715e>// 1
</span><span style=color:#75715e>// 2
</span></code></pre></div><h3 id=비동기-생성자를-통한-열거-식httpsdevelopermozillaorgkodocswebjavascriptreferencestatementsfor-awaitof비동기_생성자를_통한_열거_식><a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/for-await...of#%EB%B9%84%EB%8F%99%EA%B8%B0_%EC%83%9D%EC%84%B1%EC%9E%90%EB%A5%BC_%ED%86%B5%ED%95%9C_%EC%97%B4%EA%B1%B0_%EC%8B%9D>비동기 생성자를 통한 열거 식</a><a hidden class=anchor aria-hidden=true href=#비동기-생성자를-통한-열거-식httpsdevelopermozillaorgkodocswebjavascriptreferencestatementsfor-awaitof비동기_생성자를_통한_열거_식>#</a></h3><p>비동기 생성자는 애초부터 비동기 열거 프로토콜을 탑재한 채로 정의한다.이를 <code>for await...of</code> 식으로 아래와 같이 사용할 수 있다.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>asyncGenerator</span>() {
  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>3</span>) {
    <span style=color:#66d9ef>yield</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>;
  }
}

(<span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span>() {
  <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>await</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>num</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>asyncGenerator</span>()) {
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>num</span>);
  }
})();
<span style=color:#75715e>// 0
</span><span style=color:#75715e>// 1
</span><span style=color:#75715e>// 2
</span></code></pre></div><p>좀 더 상세한 비동기 생성자를 통한 <code>for await...of </code>식의 사용법을 위해 기본 API를 통해 값을 비동기적으로 열거하는 방법을 알아본다.</p><p>아래 예제를 통해 먼저 API를 사용하여 스트림 데이터를 통해 비동기 열거자를 만든 뒤, 스트림에서 응답이 끝나면 최종 응답 데이터 크기를 가져온다.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>streamAsyncIterator</span>(<span style=color:#a6e22e>stream</span>) {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>reader</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>stream</span>.<span style=color:#a6e22e>getReader</span>();
  <span style=color:#66d9ef>try</span> {
    <span style=color:#66d9ef>while</span> (<span style=color:#66d9ef>true</span>) {
      <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>done</span>, <span style=color:#a6e22e>value</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>read</span>();
      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>done</span>) {
        <span style=color:#66d9ef>return</span>;
      }
      <span style=color:#66d9ef>yield</span> <span style=color:#a6e22e>value</span>;
    }
  } <span style=color:#66d9ef>finally</span> {
    <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>releaseLock</span>();
  }
}
<span style=color:#75715e>// 주소로부터 데이터를 받아온 뒤, 응답 크기를 구하는 비동기 생성자 함수.
</span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getResponseSize</span>(<span style=color:#a6e22e>url</span>) {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>url</span>);
  <span style=color:#75715e>// 여기에 응답 크기를 바이트 단위로 적재한다.
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>responseSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  <span style=color:#75715e>// for-await-of 문을 통해 응답이 들어올 때마다 열거 프로토콜을 통해 반복문이 작동한다.
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>await</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>chunk</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>streamAsyncIterator</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>body</span>)) {
    <span style=color:#75715e>// 총 응답 크기를 지속적으로 누적한다.
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>responseSize</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>chunk</span>.<span style=color:#a6e22e>length</span>;
  }

  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`응답 크기: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>responseSize</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 바이트`</span>);
  <span style=color:#75715e>// 예상 출력: &#34;응답 크기: 1071472 바이트&#34;
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>responseSize</span>;
}
<span style=color:#a6e22e>getResponseSize</span>(<span style=color:#e6db74>&#39;https://jsonplaceholder.typicode.com/photos&#39;</span>);
</code></pre></div><h2 id=my-example>My Example<a hidden class=anchor aria-hidden=true href=#my-example>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TradeDb</span> {
  <span style=color:#a6e22e>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>filename</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
  }
  <span style=color:#75715e>// *
</span><span style=color:#75715e></span>  <span style=color:#75715e>// *
</span><span style=color:#75715e></span>  <span style=color:#75715e>// *
</span><span style=color:#75715e></span>
  <span style=color:#66d9ef>async</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>each</span>(<span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>AsyncGenerator</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Iu</span>.<span style=color:#a6e22e>TradeTickType</span>, <span style=color:#66d9ef>void</span>, <span style=color:#a6e22e>unknown</span><span style=color:#f92672>&gt;</span> {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>length</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>500</span>
    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>offset</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>trs</span> <span style=color:#f92672>=</span> []
    <span style=color:#66d9ef>do</span> {
      <span style=color:#a6e22e>trs</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>code</span>, <span style=color:#a6e22e>offset</span>, <span style=color:#a6e22e>length</span>)
      <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>tr</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>trs</span>) {
        <span style=color:#66d9ef>yield</span> <span style=color:#a6e22e>tr</span>
      }
      <span style=color:#a6e22e>offset</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>trs</span>.<span style=color:#a6e22e>length</span>
    } <span style=color:#66d9ef>while</span>(<span style=color:#a6e22e>trs</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>)
  }
}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UPbitTradeMock</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>BaseUPbitSocket</span> {
  <span style=color:#a6e22e>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>db</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>TradeDb</span>) {
    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>staticCodes</span>())
  }

  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>open</span>()<span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>void</span><span style=color:#f92672>&gt;</span> {
    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>start</span>()
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>codes</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>codes</span>()
    <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>code</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>codes</span>) {
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bots</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getBots</span>(<span style=color:#a6e22e>I</span>.<span style=color:#a6e22e>ReqType</span>.<span style=color:#a6e22e>Trade</span>, <span style=color:#a6e22e>code</span>)
      <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>await</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>tr</span> <span style=color:#66d9ef>of</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>each</span>(<span style=color:#a6e22e>code</span>)) {
        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>converted</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>convertTradeType</span>(<span style=color:#a6e22e>tr</span>)
        <span style=color:#66d9ef>await</span> Promise.<span style=color:#a6e22e>all</span>(<span style=color:#a6e22e>bots</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>bot</span> =&gt; <span style=color:#a6e22e>bot</span>.<span style=color:#a6e22e>trigger</span>(<span style=color:#a6e22e>converted</span>)))
      }
      <span style=color:#66d9ef>await</span> Promise.<span style=color:#a6e22e>all</span>(<span style=color:#a6e22e>bots</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>bot</span> =&gt; <span style=color:#a6e22e>bot</span>.<span style=color:#a6e22e>finish</span>()))
    }
  }
}
</code></pre></div><h2 id=see-also>See Also<a hidden class=anchor aria-hidden=true href=#see-also>#</a></h2><ul><li><a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/for-await...of>https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/for-await...of</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://bynaki.github.io/tags/js/>js</a></li><li><a href=https://bynaki.github.io/tags/async/>async</a></li><li><a href=https://bynaki.github.io/tags/wait/>wait</a></li><li><a href=https://bynaki.github.io/tags/promise/>promise</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        Written by 
        <a href=/ rel=noopener target=_blank>bynaki</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>